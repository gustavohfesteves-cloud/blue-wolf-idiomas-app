<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zone 1 - BlueWolf</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Orbitron:wght@700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        body {
            font-family: 'Press Start 2P', cursive;
            background-color: #020617;
            color: white;
            overflow-x: hidden;
        }

        /* Caminho de Circuito */
        .circuit-line {
            position: absolute;
            width: 8px;
            background: #1e293b;
            left: 50%;
            transform: translateX(-50%);
            z-index: 0;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
            height: 100%;
        }

        /* Estilo dos Botões de Nível */
        .level-node {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            z-index: 10;
            transition: all 0.3s;
            cursor: pointer;
            font-family: 'Orbitron', sans-serif;
            font-weight: 900;
            font-size: 1.5rem;
            text-shadow: 0 2px 0 rgba(0,0,0,0.5);
        }

        /* Nível Aberto */
        .node-unlocked {
            background: radial-gradient(circle at 30% 30%, #0ea5e9, #0369a1);
            border: 4px solid #38bdf8;
            box-shadow: 0 0 20px rgba(56, 189, 248, 0.4);
        }
        .node-unlocked:hover {
            transform: scale(1.1);
            border-color: #fbbf24;
            box-shadow: 0 0 30px rgba(251, 191, 36, 0.6);
        }

        /* Nível Bloqueado */
        .node-locked {
            background: #1e293b;
            border: 4px solid #475569;
            color: #64748b;
            cursor: not-allowed;
            filter: grayscale(100%);
        }

        /* Nível Concluído */
        .node-completed {
            background: radial-gradient(circle at 30% 30%, #10b981, #059669);
            border: 4px solid #34d399;
            box-shadow: 0 0 15px rgba(52, 211, 153, 0.3);
        }

        /* O Baú */
        .chest-node {
            width: 100px;
            height: 80px;
            background: url('https://cdn-icons-png.flaticon.com/512/4230/4230569.png'); 
            background-size: cover;
            background-position: center;
            z-index: 10;
            transition: transform 0.3s;
            filter: grayscale(100%);
            opacity: 0.6;
            cursor: not-allowed;
        }
        .chest-unlocked {
            filter: grayscale(0%);
            opacity: 1;
            cursor: pointer;
            animation: bounce 2s infinite;
        }
        .chest-opened {
            filter: brightness(1.5) sepia(1); /* Efeito dourado/aberto */
            animation: none;
            cursor: default;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        /* HUD Superior */
        .hud-panel {
            font-family: 'Orbitron', sans-serif;
            background: rgba(15, 23, 42, 0.95);
            border-bottom: 2px solid #22d3ee;
            backdrop-filter: blur(5px);
        }
        
        .coin-counter {
            background: linear-gradient(90deg, #ca8a04, #eab308);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 0 10px rgba(234, 179, 8, 0.3);
        }
    </style>
</head>
<body class="flex flex-col items-center min-h-screen pb-20">

    <div class="fixed top-0 w-full z-50 hud-panel flex justify-between items-center px-4 py-3 shadow-lg">
        <a href="dashboard.html" class="flex items-center gap-2 text-cyan-400 hover:text-white transition-colors">
            <i class="fa-solid fa-chevron-left"></i>
            <span class="text-xs font-bold tracking-widest">MAPA MUNDI</span>
        </a>
        
        <div class="flex gap-7">
            <div class="flex items-center gap-2">
                <i class="fa-solid fa-coins text-yellow-400 animate-pulse"></i>
                <span id="display-coins" class="text-sm font-bold coin-counter">0 WC</span>
            </div>
        </div>
    </div>

    <div class="mt-24 mb-8 text-center px-4">
        <h1 class="text-lg md:text-2xl text-cyan-300 drop-shadow-[0_0_8px_rgba(34,211,238,0.8)] uppercase leading-relaxed">
            Zone 1<br>
            <span class="text-sm md:text-base text-white">Eating and Drinking</span>
        </h1>
    </div>

    <div class="relative w-full max-w-md flex flex-col items-center gap-12 px-6 pb-24">
        
        <div class="circuit-line top-4 h-[90%] bg-gradient-to-b from-cyan-900 to-slate-900"></div>

        <div id="levels-container" class="contents"></div>

        <div id="final-chest" class="chest-node"></div>
        <div class="z-10 bg-slate-900 px-3 py-1 rounded border border-yellow-600 text-[10px] text-yellow-400 tracking-widest">REWARD</div>

    </div>

    <script>
        // --- CONFIGURAÇÃO DO SISTEMA WOLFCOIN & PROGRESSO ---

        // 1. Carregar dados
        // Nota: O Nível 5 termina setando o progresso para 6. Se for 6, o baú desbloqueia.
        let userProgress = parseInt(localStorage.getItem('bw_zone1_progress')) || 1; 
        let userCoins = parseInt(localStorage.getItem('bw_wolfcoins')) || 0; 
        let chestClaimed = localStorage.getItem('bw_zone1_chest') === 'true'; 

        // Atualiza HUD
        document.getElementById('display-coins').innerText = userCoins + " WC";

        // --- RENDERIZAÇÃO DO MAPA ---
        const container = document.getElementById('levels-container');
        const totalLevels = 5;

        for (let i = 1; i <= totalLevels; i++) {
            const levelDiv = document.createElement('div');
            
            // Lógica de Estado
            if (i <= userProgress) {
                // DESBLOQUEADO
                levelDiv.className = `level-node node-unlocked group`;
                
                if (i < userProgress) {
                    // Completado
                    levelDiv.classList.add('node-completed');
                    levelDiv.innerHTML = `<i class="fa-solid fa-check text-white"></i>`;
                } else {
                    // Atual
                    levelDiv.innerText = i;
                }

                // Tooltip
                levelDiv.innerHTML += `
                    <div class="absolute left-24 w-32 bg-slate-800 text-[10px] p-2 rounded border border-cyan-500 opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none text-left z-20">
                        ACTIVITY SET ${i}
                    </div>
                `;

                // Link de Navegação: (Nível-1)*3 + 1
                const targetPage = `atividade_${((i - 1) * 3) + 1}.html`;
                
                // Se o usuário já passou do nível (userProgress > i), podemos deixar ele jogar de novo?
                // Sim, para praticar.
                levelDiv.onclick = () => {
                    window.location.href = targetPage;
                };

            } else {
                // BLOQUEADO
                levelDiv.className = `level-node node-locked`;
                levelDiv.innerHTML = `<i class="fa-solid fa-lock text-sm"></i>`;
                levelDiv.onclick = () => {
                    // Shake effect
                    levelDiv.style.transform = "translateX(5px)";
                    setTimeout(() => levelDiv.style.transform = "translateX(0)", 100);
                    setTimeout(() => levelDiv.style.transform = "translateX(-5px)", 200);
                    setTimeout(() => levelDiv.style.transform = "translateX(0)", 300);
                };
            }

            container.appendChild(levelDiv);
        }

        // --- LÓGICA DO BAÚ (CORRIGIDA) ---
        const chest = document.getElementById('final-chest');

        // Se o progresso for maior que o total de níveis (ou seja, completou o nível 5)
        if (userProgress > totalLevels) {
            
            if (!chestClaimed) {
                // CASO 1: Desbloqueado mas não pego
                chest.classList.add('chest-unlocked');
                
                // Adiciona o evento de clique para ir para a página de recompensa
                chest.addEventListener('click', function() {
                    // Toca som (opcional) e redireciona
                    console.log("Indo para recompensa...");
                    window.location.href = "reward_zone1.html";
                });

            } else {
                // CASO 2: Já pegou
                chest.classList.add('chest-unlocked', 'chest-opened');
                // Não faz nada ao clicar, ou pode mostrar um alerta "Já coletado"
                chest.title = "Recompensa já coletada";
            }
        } 
        // CASO 3: Bloqueado (userProgress <= 5) é o padrão do CSS

        // --- DEV TOOLS ---
        window.resetarProgresso = function() {
            localStorage.setItem('bw_zone1_progress', 1);
            localStorage.setItem('bw_wolfcoins', 0);
            localStorage.setItem('bw_zone1_chest', 'false');
            location.reload();
        }
        
        window.pularParaBau = function() {
            localStorage.setItem('bw_zone1_progress', 6);
            location.reload();
        }
    </script>
<div id="reward-btn-container" class="hidden mt-4">
    <button onclick="activarRecompensa()" class="bg-yellow-400 hover:bg-yellow-300 text-black font-black py-3 px-8 rounded-xl shadow-[0_0_20px_rgba(250,204,21,0.6)] animate-pulse border-b-4 border-yellow-700 active:translate-y-1 active:border-b-0 uppercase tracking-widest">
        <i class="fa-solid fa-gift mr-2"></i> Pegar Recompensa
    </button>
</div>

<div id="video-overlay" class="hidden fixed inset-0 bg-black z-[999] flex items-center justify-center">
    <div class="relative w-full max-w-4xl p-4">
        <p class="text-center text-gray-500 mb-2 animate-pulse">Assista para desbloquear a Zona 2...</p>
        <video id="final-video" class="w-full rounded-lg shadow-2xl border border-gray-800" playsinline>
            <source src="reward_zone1.mp4" type="video/mp4">
        </video>
    </div>
</div>

<script>
    // 1. Verificar se o jogador merece o botão (Passou do Nível 5)
    // Nota: Certifique-se que o Nível 5 (atividade 17) salvou 'bw_zone1_progress' como 6
    if (parseInt(localStorage.getItem('bw_zone1_progress') || 1) > 5) {
        
        // Revelar o container do botão
        const btnContainer = document.getElementById('reward-btn-container');
        btnContainer.classList.remove('hidden');

        // Mover o botão para ficar visualmente logo abaixo do elemento do baú
        const bau = document.getElementById('final-chest');
        if(bau) {
            bau.parentNode.insertBefore(btnContainer, bau.nextSibling);
            // Opcional: Esconder o baú antigo para não confundir, ou deixar os dois
            // bau.style.display = 'none'; 
        }
    }

    // 2. Função de Ativação
    function activarRecompensa() {
        const overlay = document.getElementById('video-overlay');
        const vid = document.getElementById('final-video');

        // Mostrar vídeo
        overlay.classList.remove('hidden');
        
        // Tentar tocar (Navegadores modernos exigem interação prévia, o clique no botão garante isso)
        vid.play().catch(e => console.log("Erro autoplay:", e));

        // 3. O Grande Final (Quando o vídeo acaba)
        vid.onended = function() {
            // A. Liberar Zona 2
            localStorage.setItem('bw_zone2_unlocked', 'true');
            
            // B. Dar Moedas (50 WC)
            let currentCoins = parseInt(localStorage.getItem('bw_wolfcoins') || 0);
            localStorage.setItem('bw_wolfcoins', currentCoins + 50);

            // C. Tchau Zona 1 -> Olá Mapa Mundi
            window.location.href = 'ilhadeatividades.html';
        };
    }
</script>
</body>
</html>
